BootStrap: docker
From: ubuntu:20.04

%runscript
	/bin/bash runMatlab.sh

%environment
	export LD_LIBRARY_PATH="/usr/local/MATLAB/MATLAB_Compiler_Runtime/v83/runtime/glnxa64:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v83/bin/glnxa64:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v83/sys/os/glnxa64":$LD_LIBRARY_PATH
	export XAPPLRESDIR="/usr/local/MATLAB/MATLAB_Compiler_Runtime/v83/X11/app-defaults":$XAPPLRESDIR

%files
	./runMatlab.sh /usr/local/bin/runMatlab.sh
	./matlab.conf /etc/ld.so.conf.d/matlab.conf
	./gp_gistic2_from_seg /usr/local/bin/gp_gistic2_from_seg

%post
	apt-get update && apt-get upgrade -y
	apt-get install -y wget bc vim libxpm4 libxext6 libxt6 libxmu6 libxrender1 libxtst6 libxt6 zip unzip build-essential
	wget https://apt.ligo-wa.caltech.edu:8443/debian/pool/stretch/libxp6/libxp6_1.0.2-2_amd64.deb && dpkg -i libxp6_1.0.2-2_amd64.deb && rm libxp6_1.0.2-2_amd64.deb
	mkdir -p /home/gistic/MCRInstaller
	cd /home/gistic/MCRInstaller && wget https://www.mathworks.com/supportfiles/downloads/R2014a/deployment_files/R2014a/installers/glnxa64/MCR_R2014a_glnxa64_installer.zip && unzip MCR_R2014a_glnxa64_installer.zip && rm -rf MCR_R2014a_glnxa64_installer.zip
	chmod a+x /usr/local/bin/runMatlab.sh && cd /home/gistic/MCRInstaller && /home/gistic/MCRInstaller/install -mode silent -agreeToLicense yes 
	apt-get autoremove -y
	apt-get clean
	
%labels
	Author Xiaoguang Pan
	Version 2.0
		 
%help
	Using github action to build a singularity image for Gistic 2.0(V7)